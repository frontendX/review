# 前端优化策略

### 1、DOM 操作优化

先了解两个概念 —— Repaint 和 Reflow：

##### 1.1、Repaint
Repaint 指的是一种不会影响当前 DOM 的结构和布局的一种重绘动作。如下动作会产生 Repaint 动作：
- 不可见到可见（visibility 样式属性）;
- 颜色或图片变化（background, border-color, color 样式属性）;
- 不改变页面元素大小，形状和位置，但改变其外观的变化

##### 1.2、Reflow
Reflow 比起 Repaint 来讲就是一种更加显著的变化了。
它主要发生在 DOM 树被操作的时候，任何改变 DOM 的结构和布局都会产生 Reflow。
但一个元素的 Reflow 操作发生时，它的所有父元素和子元素都会放生 Reflow，最后 Reflow 必然会导致 Repaint 的产生。

举例说明，如下动作会产生 Reflow 动作：
- 浏览器窗口的变化;
- 一些改变页面元素大小，形状和位置的操作的触发
- 改变文字大小
- 内容的改变，如用户在输入框中敲字
- 激活伪类，如:hover
- 操作class属性
- 脚本操作DOM
- 计算offsetWidth和offsetHeight
- 设置style属性

那么为了减少回流要注意哪些方式呢？
- 不要通过父级来改变子元素样式，最好直接改变子元素样式，改变子元素样式尽可能不要影响父元素和兄弟元素的大小和尺寸
- 尽量通过class来设计元素样式，切忌用style

### 2、缓存
##### 2.1、`Expires  Cache-Control  Last-Modified  ETag  If-Modified-Since  If-None-Match` 这些请求头部在浏览器缓存中分别起什么作用，如何起到缓存的作用？
- 当某一文件在浏览器中第一次被访问的时候，这个时候浏览器是没有缓存的，直接从服务器获取文件，返回给客户端，并且存入浏览器缓存；此时，返回状态码200，并且服务端可以设置响应头部Expires或者Cache-Control，Last-Modified或者ETag。
- 如果设置了Expires或者Cache-Control，那么在指定时间内再次请求该文件时，只要不强制刷新缓存(F5等)，浏览器会直接读取缓存而不再去请求服务器。
- 如果没有设置Expires或者Cache-Control或者过期了，就需要再次请求服务器了，浏览器会发起条件验证，发起请求时在请求头加上If-Modified-Sinse或者If-None-Match，服务器端判断最新的文件是否发生了更新，如果没有，总则返回响应状态码304，并且不带任何响应实体，也就是说，传输到客户端的只有一些相应头部，响应实体是空的，这样就大大减少了传输的体积，浏览器接受到了304响应，就知道了要读取浏览器缓存了。

##### 2.2、按回车、浏览器刷新按钮、F5、Ctrl+F5的区别？
- 按回车，浏览器会判断是否有缓存，并且根据Expires或者Cache-Control判断缓存是否过期，如果没有，就不会发起请求，直接使用缓存。否则就需要像服务器发起请求再验证。
- 浏览器刷新按钮和F5效果相同，不管是否有Expires或者Cache-Control，都会强制去请求服务器，进行再验证，根据If-Modified-Sinse或者If-None-Match判断是否要返回304，如果是，浏览器就会继续使用缓存。
- 按Ctrl+F5时，也是不管是否有Expires或者Cache-Control，都会强制去请求服务器，但是并不会进行再验证，服务器会直接把最新的内容返回给浏览器，压根就不考虑缓存的存在或者是否过期。
